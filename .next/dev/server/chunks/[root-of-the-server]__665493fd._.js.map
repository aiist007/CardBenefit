{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/apple/Downloads/myapps/credit/src/app/api/chat/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\nimport OpenAI from 'openai';\n\nexport async function POST(req: NextRequest) {\n    try {\n        const { messages, contextBenefits } = await req.json();\n\n        const apiKey = process.env.GOOGLE_AI_STUDIO_API_KEY;\n        if (!apiKey) {\n            return NextResponse.json({ error: 'API Key not configured' }, { status: 500 });\n        }\n\n        const openai = new OpenAI({\n            apiKey: apiKey,\n            baseURL: 'https://llm.ai-nebula.com/v1'\n        });\n\n        // Construct the system message with database context\n        const contextString = JSON.stringify(contextBenefits, null, 2);\n        \n        const systemContent = `你是一个专业的信用卡权益助手。你可以基于用户已有的信用卡权益数据库来回答问题。\n            \n当前数据库中的权益信息如下：\n${contextString}\n\n**对话规则：**\n1. **优先基于数据库：** 优先基于上述数据库信息回答。如果数据库中有相关卡片的权益，请详细列出。\n2. **补充网上搜索：** 如果数据库中没有相关信息，或者信息不全，请基于你作为 AI 的通用知识（模拟网上搜索总结）来补充。对于主流银行（如招商、工商、建行等）的经典卡片（如经典白、百夫长等），你应该能给出准确的权益总结。\n3. **结合实际建议：** 给出如何最大化利用这些权益的建议（例如：消费达标、生日倍数积分等）。\n4. **输出排版：** 使用清晰的 Markdown 格式排版。\n   - 使用 **加粗** 突出银行、卡片和关键金额。\n   - 使用 ### 标题分隔不同银行或分类。\n   - 使用无序列表 - 列出具体权益。\n   - 使用表格展示对比信息（如多张卡的同类权益对比）。\n5. 回答要简洁、专业、条理清晰。`;\n\n        const systemMessage = {\n            role: \"system\",\n            content: systemContent\n        };\n\n        // Combine system message with conversation history (last 8-10 turns managed by frontend)\n        const fullMessages = [systemMessage, ...messages];\n\n        const response = await openai.chat.completions.create({\n            model: \"gemini-3-flash-preview\",\n            messages: fullMessages,\n            temperature: 0.7,\n            max_tokens: 2000,\n        });\n\n        return NextResponse.json({ \n            content: response.choices[0].message.content \n        });\n\n    } catch (error: any) {\n        console.error('Chat API Error:', error);\n        return NextResponse.json({ error: error.message }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AAAA;;;AAEO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,MAAM,EAAE,QAAQ,EAAE,eAAe,EAAE,GAAG,MAAM,IAAI,IAAI;QAEpD,MAAM,SAAS,QAAQ,GAAG,CAAC,wBAAwB;QACnD,IAAI,CAAC,QAAQ;YACT,OAAO,gJAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAyB,GAAG;gBAAE,QAAQ;YAAI;QAChF;QAEA,MAAM,SAAS,IAAI,mLAAM,CAAC;YACtB,QAAQ;YACR,SAAS;QACb;QAEA,qDAAqD;QACrD,MAAM,gBAAgB,KAAK,SAAS,CAAC,iBAAiB,MAAM;QAE5D,MAAM,gBAAgB,CAAC;;;AAG/B,EAAE,cAAc;;;;;;;;;;;iBAWC,CAAC;QAEV,MAAM,gBAAgB;YAClB,MAAM;YACN,SAAS;QACb;QAEA,yFAAyF;QACzF,MAAM,eAAe;YAAC;eAAkB;SAAS;QAEjD,MAAM,WAAW,MAAM,OAAO,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YAClD,OAAO;YACP,UAAU;YACV,aAAa;YACb,YAAY;QAChB;QAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS,SAAS,OAAO,CAAC,EAAE,CAAC,OAAO,CAAC,OAAO;QAChD;IAEJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mBAAmB;QACjC,OAAO,gJAAY,CAAC,IAAI,CAAC;YAAE,OAAO,MAAM,OAAO;QAAC,GAAG;YAAE,QAAQ;QAAI;IACrE;AACJ"}}]
}